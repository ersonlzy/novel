version: '3.8'

services:
  novel-copilot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: novel-copilot
    ports:
      - "8501:8501"
    volumes:
      # 数据库持久化
      - ./data/db:/app/.db
      # 向量数据库持久化
      - ./data/vectordb:/app/.vectordb
      # 用户上传的数据文件
      - ./data/files:/app/data
      # 环境配置文件
      # - ./.env:/app/.env
    environment:
      # 从环境变量读取配置
      - MAX_GENERATE_NUM=${MAX_GENERATE_NUM:-10}
      - MAX_CHAPTERS_WORD_NUM=${MAX_CHAPTERS_WORD_NUM:-6000}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - DEEPSEEK_BASE_URL=${DEEPSEEK_BASE_URL}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - DASHSCOPE_BASE_URL=${DASHSCOPE_BASE_URL}
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
      - SILICONFLOW_BASE_URL=${SILICONFLOW_BASE_URL}
      - SILICONFLOW_API_KEY=${SILICONFLOW_API_KEY}
      - ZHIPUAI_BASE_URL=${ZHIPUAI_BASE_URL}
      - ZHIPUAI_API_KEY=${ZHIPUAI_API_KEY}
    # 使用 uv run 启动
    command: uv run streamlit run main.py --server.port=8501 --server.address=0.0.0.0
    restart: always
    networks:
      - novel-network

networks:
  novel-network:
    driver: bridge
